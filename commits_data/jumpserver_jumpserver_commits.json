{
  "repo_name": "jumpserver/jumpserver",
  "commits": [
    {
      "sha": "51d7e511199af4a8205eafa23f9630eb8b2d7c62",
      "message": "fix: AttributeError: 'SessionReplayViewSet' object has no attribute 'ACCESS_KEY'",
      "changes": [
        {
          "file": "apps/terminal/api.py",
          "patch": "@@ -300,7 +300,7 @@ def s3Client(self, config):\n         REGION = config.get(\"REGION\", None)\n         ACCESS_KEY = config.get(\"ACCESS_KEY\", None)\n         SECRET_KEY = config.get(\"SECRET_KEY\", None)\n-        if self.ACCESS_KEY and REGION and SECRET_KEY:\n+        if ACCESS_KEY and REGION and SECRET_KEY:\n             s3 = boto3.client('s3',\n                               region_name=REGION,\n                               aws_access_key_id=ACCESS_KEY,"
        }
      ]
    },
    {
      "sha": "290872dcade674ec8f87da579b22e552bc7fe52a",
      "message": "bugfix: \u89e3\u51b3\u7528\u6237\u5931\u6548\u65f6\u95f4\u4e3a\u7a7a\u65f6\uff0c\u65e0\u6cd5\u4f7f\u7528\u5bc6\u7801\u8fdb\u884cssh\u767b\u5f55\u8df3\u677f\u673a\u7684\u95ee\u9898 (#659)\n\n* bugfix: \u89e3\u51b3\u7528\u6237\u5931\u6548\u65f6\u95f4\u4e3a\u7a7a\u65f6\uff0c\u65e0\u6cd5\u4f7f\u7528\u5bc6\u7801\u8fdb\u884cssh\u767b\u5f55\u8df3\u677f\u673a\u7684\u95ee\u9898\r\n\r\nbugfix: \u89e3\u51b3\u7528\u6237\u5931\u6548\u65f6\u95f4\u4e3a\u7a7a\u65f6\uff0c\u65e0\u6cd5\u4f7f\u7528\u5bc6\u7801\u8fdb\u884cssh\u767b\u5f55\u8df3\u677f\u673a\u7684\u95ee\u9898\u3002\r\n\r\n```\r\nAttributeError at /api/users/v1/auth/\r\n'NoneType' object has no attribute 'strftime'\r\n\r\nRequest Method: POST\r\nRequest URL: http://127.0.0.1:8080/api/users/v1/auth/\r\nDjango Version: 1.11.4\r\nPython Executable: /opt/py3/bin/python\r\nPython Version: 3.6.1\r\nPython Path: ['/data/deployment/jumpserver/apps', '/usr/local/lib/python36.zip', '/usr/local/lib/python3.6', '/usr/local/lib/python3.6/lib-dynload', '/opt/py3/lib/python3.6/site-packages', '/data/deployment/jumpserver', '/data/deployment/jumpserver/apps']\r\nServer time: Wed, 30 Aug 2017 23:18:47 +0800\r\nInstalled Applications:\r\n['users.apps.UsersConfig',\r\n 'assets.apps.AssetsConfig',\r\n 'perms.apps.PermsConfig',\r\n 'ops.apps.OpsConfig',\r\n 'audits.apps.AuditsConfig',\r\n 'common.apps.CommonConfig',\r\n 'applications.apps.ApplicationsConfig',\r\n 'rest_framework',\r\n 'rest_framework_swagger',\r\n 'django_filters',\r\n 'bootstrap3',\r\n 'captcha',\r\n 'django.contrib.auth',\r\n 'django.contrib.contenttypes',\r\n 'django.contrib.sessions',\r\n 'django.contrib.messages',\r\n 'django.contrib.staticfiles']\r\nInstalled Middleware:\r\n['django.middleware.security.SecurityMiddleware',\r\n 'django.contrib.sessions.middleware.SessionMiddleware',\r\n 'django.middleware.locale.LocaleMiddleware',\r\n 'django.middleware.common.CommonMiddleware',\r\n 'django.middleware.csrf.CsrfViewMiddleware',\r\n 'django.contrib.auth.middleware.AuthenticationMiddleware',\r\n 'django.contrib.messages.middleware.MessageMiddleware',\r\n 'django.middleware.clickjacking.XFrameOptionsMiddleware',\r\n 'jumpserver.middleware.TimezoneMiddleware',\r\n 'jumpserver.middleware.DemoMiddleware']\r\n\r\n\r\nTraceback:  \r\n\r\nFile \"/opt/py3/lib/python3.6/site-packages/django/core/handlers/exception.py\" in inner\r\n  41.             response = get_response(request)\r\nFile \"/opt/py3/lib/python3.6/site-packages/django/core/handlers/base.py\" in _get_response\r\n  187.                 response = self.process_exception_by_middleware(e, request)\r\nFile \"/opt/py3/lib/python3.6/site-packages/django/core/handlers/base.py\" in _get_response\r\n  185.                 response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\nFile \"/usr/local/lib/python3.6/contextlib.py\" in inner\r\n  53.                 return func(*args, **kwds)\r\nFile \"/opt/py3/lib/python3.6/site-packages/django/views/decorators/csrf.py\" in wrapped_view\r\n  58.         return view_func(*args, **kwargs)\r\nFile \"/opt/py3/lib/python3.6/site-packages/django/views/generic/base.py\" in view\r\n  68.             return self.dispatch(request, *args, **kwargs)\r\nFile \"/opt/py3/lib/python3.6/site-packages/rest_framework/views.py\" in dispatch\r\n  489.             response = self.handle_exception(exc)\r\nFile \"/opt/py3/lib/python3.6/site-packages/rest_framework/views.py\" in handle_exception\r\n  449.             self.raise_uncaught_exception(exc)\r\nFile \"/opt/py3/lib/python3.6/site-packages/rest_framework/views.py\" in dispatch\r\n  486.             response = handler(request, *args, **kwargs)\r\nFile \"/data/deployment/jumpserver/apps/users/api.py\" in post\r\n  166.             return Response({'token': token, 'user': user.to_json()})\r\nFile \"/data/deployment/jumpserver/apps/users/models/user.py\" in to_json\r\n  207.             'date_expired': self.date_expired.strftime('%Y-%m-%d %H:%M:%S')\r\n\r\nException Type: AttributeError at /api/users/v1/auth/\r\nException Value: 'NoneType' object has no attribute 'strftime'\r\nRequest information:\r\nUSER: AnonymousUser\r\nGET: No GET data\r\nPOST: No POST data\r\nFILES: No FILES data\r\nCOOKIES: No cookie data\r\n```\r\n\r\n* bugfix: \u4e2a\u4eba\u4fe1\u606f\u9875\u9762\u4e2a\u4eba\u4fe1\u606fpannel\u9519\u4f4d\r\n\r\nbugfix: \u4e2a\u4eba\u4fe1\u606f\u9875\u9762\u4e2a\u4eba\u4fe1\u606fpannel\u9519\u4f4d",
      "changes": [
        {
          "file": "apps/users/models/user.py",
          "patch": "@@ -204,7 +204,7 @@ def to_json(self):\n             'wechat': self.wechat,\n             'phone': self.phone,\n             'comment': self.comment,\n-            'date_expired': self.date_expired.strftime('%Y-%m-%d %H:%M:%S')\n+            'date_expired': self.date_expired.strftime('%Y-%m-%d %H:%M:%S') if self.date_expired is not None else None\n         })\n \n     @classmethod"
        }
      ]
    }
  ]
}